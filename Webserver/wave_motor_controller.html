<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Banco de pruebas Oscilante</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
        }

        h1 {
            text-align: center;
            color: white;
            margin-bottom: 30px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .main-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .panel {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            backdrop-filter: blur(10px);
        }

        .panel h2 {
            color: #5a67d8;
            margin-bottom: 20px;
            border-bottom: 2px solid #5a67d8;
            padding-bottom: 10px;
        }

        .panel h3 {
            color: #718096;
            margin: 15px 0 10px;
            font-size: 1.1em;
        }

        .wave-canvas {
            width: 100%;
            height: 350px;
            background: #f7fafc;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .component-list {
            max-height: 400px;
            overflow-y: auto;
            margin: 15px 0;
            padding: 10px;
            background: #f7fafc;
            border-radius: 8px;
        }

        .wave-component {
            background: white;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            position: relative;
            transition: all 0.3s ease;
        }

        .wave-component:hover {
            border-color: #5a67d8;
            box-shadow: 0 2px 10px rgba(90, 103, 216, 0.2);
        }

        .component-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .component-title {
            font-weight: 600;
            color: #2d3748;
        }

        .component-controls {
            display: grid;
            gap: 10px;
        }

        .control-item {
            display: grid;
            grid-template-columns: 100px 1fr 80px;
            align-items: center;
            gap: 10px;
        }

        .control-item-small {
            display: grid;
            grid-template-columns: 80px 1fr 60px;
            align-items: center;
            gap: 8px;
            font-size: 0.9em;
        }

        label {
            color: #4a5568;
            font-weight: 500;
        }

        input[type="range"] {
            width: 100%;
            height: 6px;
            background: #e2e8f0;
            border-radius: 5px;
            outline: none;
            -webkit-appearance: none;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 16px;
            height: 16px;
            background: #5a67d8;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        input[type="range"]::-webkit-slider-thumb:hover {
            background: #667eea;
            transform: scale(1.2);
        }

        input[type="range"]::-moz-range-thumb {
            width: 16px;
            height: 16px;
            background: #5a67d8;
            border-radius: 50%;
            cursor: pointer;
            border: none;
            transition: all 0.3s ease;
        }

        input[type="range"]::-moz-range-thumb:hover {
            background: #667eea;
            transform: scale(1.2);
        }

        .value-display {
            background: #edf2f7;
            padding: 4px 8px;
            border-radius: 5px;
            text-align: center;
            font-weight: bold;
            color: #2d3748;
            font-size: 0.85em;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: #5a67d8;
            color: white;
        }

        .btn-primary:hover {
            background: #667eea;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(90, 103, 216, 0.3);
        }

        .btn-danger {
            background: #e53e3e;
            color: white;
            padding: 5px 10px;
            font-size: 0.85em;
        }

        .btn-danger:hover {
            background: #f56565;
        }

        .btn-success {
            background: #48bb78;
            color: white;
        }

        .btn-success:hover {
            background: #38a169;
        }

        .controls-row {
            display: flex;
            gap: 10px;
            margin: 15px 0;
            align-items: center;
        }

        .type-toggle {
            display: inline-flex;
            background: #e2e8f0;
            border-radius: 20px;
            padding: 2px;
        }

        .type-toggle button {
            padding: 4px 12px;
            border: none;
            background: transparent;
            border-radius: 18px;
            cursor: pointer;
            font-size: 0.85em;
            transition: all 0.3s ease;
        }

        .type-toggle button.active {
            background: #5a67d8;
            color: white;
        }

        .motor-visual {
            background: #f7fafc;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            min-height: 120px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        .rotating-motor {
            width: 60px;
            height: 60px;
            background: linear-gradient(45deg, #4a5568 25%, #718096 25%, #718096 50%, #4a5568 50%, #4a5568 75%, #718096 75%, #718096);
            background-size: 15px 15px;
            border-radius: 50%;
            border: 3px solid #2d3748;
            animation: rotate 2s linear infinite;
            position: relative;
        }

        .rotating-motor::after {
            content: '';
            position: absolute;
            width: 8px;
            height: 30px;
            background: #e53e3e;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
        }

        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .linear-motor {
            width: 100%;
            height: 50px;
            background: #e2e8f0;
            border-radius: 25px;
            position: relative;
            overflow: hidden;
        }

        .linear-slider {
            width: 35px;
            height: 35px;
            background: linear-gradient(135deg, #667eea, #5a67d8);
            border-radius: 50%;
            position: absolute;
            top: 7.5px;
            left: 10px;
            transition: none;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        }

        .info-display {
            background: #edf2f7;
            padding: 12px;
            border-radius: 8px;
            display: grid;
            grid-template-columns: 1fr;
            gap: 8px;
            margin-top: 15px;
        }

        .info-item {
            display: flex;
            justify-content: space-between;
            padding: 5px 10px;
            background: white;
            border-radius: 5px;
            font-size: 0.9em;
        }

        .info-label {
            color: #4a5568;
        }

        .info-value {
            color: #2d3748;
            font-weight: bold;
        }

        .formula-display {
            background: #2d3748;
            color: #48bb78;
            font-family: 'Courier New', monospace;
            padding: 10px;
            border-radius: 8px;
            margin: 15px 0;
            font-size: 0.85em;
            overflow-x: auto;
            white-space: nowrap;
        }

        input[type="number"] {
            width: 60px;
            padding: 5px;
            border: 1px solid #e2e8f0;
            border-radius: 5px;
            font-weight: bold;
        }

        .color-indicator {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 8px;
            border: 2px solid white;
            box-shadow: 0 1px 3px rgba(0,0,0,0.2);
        }

        @media (max-width: 968px) {
            .main-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Banco de Pruebas Oscilante</h1>
        
        <div class="main-grid">
            <!-- Panel de Generación de Ondas -->
            <div class="panel">
                <h2>Generador de Ondas por Suma de Componentes</h2>
                
                <canvas id="waveCanvas" class="wave-canvas"></canvas>
                
                <div class="controls-row">
                    <label>Número de componentes:</label>
                    <input type="number" id="numComponents" min="1" max="10" value="2">
                    <button class="btn btn-primary" onclick="updateComponentCount()">Actualizar</button>
                    <button class="btn btn-success" onclick="addComponent()">+ Agregar</button>
                    <label style="margin-left: auto;">Velocidad:</label>
                    <input type="range" id="globalSpeed" min="0" max="100" value="50" style="width: 150px;">
                    <span class="value-display" id="speedValue">50</span>
                </div>
                
                <div class="formula-display" id="formulaDisplay">
                    y(t) = 50·sin(1.0·t + 0°) + 30·cos(2.0·t + 0°)
                </div>
                
                <div class="component-list" id="componentList">
                    <!-- Los componentes se agregarán dinámicamente aquí -->
                </div>
                
                <div class="info-display">
                    <div class="info-item">
                        <span class="info-label">Valor Y Total:</span>
                        <span class="info-value" id="currentY">0.00</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Amplitud Máxima:</span>
                        <span class="info-value" id="maxAmplitude">80</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Tiempo:</span>
                        <span class="info-value" id="timeValue">0.00 s</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Componentes Activas:</span>
                        <span class="info-value" id="activeComponents">2</span>
                    </div>
                </div>
            </div>
            
            <!-- Panel de Control de Motores -->
            <div class="panel">
                <h2>Control de Motores</h2>
                
                <!-- Motor Rotacional -->
                <h3>Motor Rotacional</h3>
                <div class="motor-visual">
                    <div class="rotating-motor" id="rotatingMotor"></div>
                </div>
                
                <div class="component-controls">
                    <div class="control-item">
                        <label>Velocidad:</label>
                        <input type="range" id="motorSpeed" min="0" max="300" value="60">
                        <span class="value-display" id="motorSpeedValue">60 RPM</span>
                    </div>
                    
                    <div class="control-item">
                        <label>Dirección:</label>
                        <select id="motorDirection" style="padding: 5px; border-radius: 5px; border: 1px solid #e2e8f0;">
                            <option value="1">Horario</option>
                            <option value="-1">Antihorario</option>
                        </select>
                        <span class="value-display">CW/CCW</span>
                    </div>
                </div>
                
                <!-- Motor Lineal -->
                <h3>Motor Lineal</h3>
                <div class="motor-visual">
                    <div class="linear-motor">
                        <div class="linear-slider" id="linearSlider"></div>
                    </div>
                </div>
                
                <div class="component-controls">
                    <div class="control-item">
                        <label>Rango:</label>
                        <input type="range" id="linearRange" min="10" max="200" value="100">
                        <span class="value-display" id="linearRangeValue">100 mm</span>
                    </div>
                    
                    <div class="control-item">
                        <label>Velocidad:</label>
                        <input type="range" id="linearSpeed" min="1" max="100" value="20">
                        <span class="value-display" id="linearSpeedValue">20 mm/s</span>
                    </div>
                    
                    <div class="control-item">
                        <label>Posición:</label>
                        <input type="range" id="linearPosition" min="0" max="200" value="0">
                        <span class="value-display" id="linearPosValue">0 mm</span>
                    </div>
                    
                    <div class="control-item">
                        <label>Modo:</label>
                        <select id="linearMode" style="padding: 5px; border-radius: 5px; border: 1px solid #e2e8f0; width: 100%;">
                            <option value="manual">Manual</option>
                            <option value="auto">Automático</option>
                            <option value="wave">Seguir Onda</option>
                        </select>
                        <span class="value-display">-</span>
                    </div>
                </div>
                
                <div class="info-display">
                    <div class="info-item">
                        <span class="info-label">Posición:</span>
                        <span class="info-value" id="currentPos">0 mm</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Velocidad:</span>
                        <span class="info-value" id="currentVel">0 mm/s</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Estado:</span>
                        <span class="info-value" id="motorStatus">Detenido</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Variables globales
        const canvas = document.getElementById('waveCanvas');
        const ctx = canvas.getContext('2d');
        let animationTime = 0;
        let linearDirection = 1;
        let currentLinearPos = 0;
        let lastFrameTime = 0;
        
        // Array de componentes de onda
        let waveComponents = [
            { type: 'sin', amplitude: 50, frequency: 1.0, phase: 0, color: '#5a67d8', enabled: true },
            { type: 'cos', amplitude: 30, frequency: 2.0, phase: 0, color: '#e53e3e', enabled: true }
        ];
        
        // Colores disponibles para las componentes
        const componentColors = [
            '#5a67d8', '#e53e3e', '#48bb78', '#ed8936', '#9f7aea',
            '#38b2ac', '#f687b3', '#4299e1', '#ecc94b', '#fc8181'
        ];
        
        // Configuración del canvas
        function resizeCanvas() {
            canvas.width = canvas.offsetWidth;
            canvas.height = canvas.offsetHeight;
        }
        
        window.addEventListener('resize', resizeCanvas);
        resizeCanvas();
        
        // Función para crear el HTML de un componente
        function createComponentHTML(component, index) {
            return `
                <div class="wave-component" id="component-${index}">
                    <div class="component-header">
                        <div class="component-title">
                            <span class="color-indicator" style="background: ${component.color}"></span>
                            Componente ${index + 1}
                        </div>
                        <button class="btn btn-danger" onclick="removeComponent(${index})">Eliminar</button>
                    </div>
                    <div class="component-controls">
                        <div class="control-item-small">
                            <label>Tipo:</label>
                            <div class="type-toggle">
                                <button class="${component.type === 'sin' ? 'active' : ''}" onclick="updateComponentType(${index}, 'sin')">sen</button>
                                <button class="${component.type === 'cos' ? 'active' : ''}" onclick="updateComponentType(${index}, 'cos')">cos</button>
                            </div>
                            <span class="value-display">${component.type}</span>
                        </div>
                        <div class="control-item-small">
                            <label>Amplitud:</label>
                            <input type="range" min="0" max="100" value="${component.amplitude}" 
                                   oninput="updateComponentValue(${index}, 'amplitude', this.value)">
                            <span class="value-display">${component.amplitude}</span>
                        </div>
                        <div class="control-item-small">
                            <label>Frecuencia:</label>
                            <input type="range" min="0.1" max="10" step="0.1" value="${component.frequency}" 
                                   oninput="updateComponentValue(${index}, 'frequency', this.value)">
                            <span class="value-display">${component.frequency.toFixed(1)} Hz</span>
                        </div>
                        <div class="control-item-small">
                            <label>Fase:</label>
                            <input type="range" min="0" max="360" value="${component.phase}" 
                                   oninput="updateComponentValue(${index}, 'phase', this.value)">
                            <span class="value-display">${component.phase}°</span>
                        </div>
                        <div class="control-item-small">
                            <label>Activar:</label>
                            <input type="checkbox" ${component.enabled ? 'checked' : ''} 
                                   onchange="updateComponentValue(${index}, 'enabled', this.checked)"
                                   style="width: 20px; height: 20px;">
                            <span class="value-display">${component.enabled ? 'ON' : 'OFF'}</span>
                        </div>
                    </div>
                </div>
            `;
        }
        
        // Función para renderizar todos los componentes
        function renderComponents() {
            const container = document.getElementById('componentList');
            container.innerHTML = waveComponents.map((comp, index) => 
                createComponentHTML(comp, index)
            ).join('');
            updateFormula();
            updateInfo();
        }
        
        // Función para actualizar el número de componentes
        function updateComponentCount() {
            const count = parseInt(document.getElementById('numComponents').value);
            const currentCount = waveComponents.length;
            
            if (count > currentCount) {
                // Agregar componentes
                for (let i = currentCount; i < count; i++) {
                    waveComponents.push({
                        type: i % 2 === 0 ? 'sin' : 'cos',
                        amplitude: 30 + Math.random() * 40,
                        frequency: 1 + Math.random() * 3,
                        phase: 0,
                        color: componentColors[i % componentColors.length],
                        enabled: true
                    });
                }
            } else if (count < currentCount) {
                // Eliminar componentes
                waveComponents = waveComponents.slice(0, count);
            }
            
            renderComponents();
        }
        
        // Función para agregar un componente
        function addComponent() {
            const index = waveComponents.length;
            waveComponents.push({
                type: index % 2 === 0 ? 'sin' : 'cos',
                amplitude: 30 + Math.random() * 40,
                frequency: 1 + Math.random() * 3,
                phase: 0,
                color: componentColors[index % componentColors.length],
                enabled: true
            });
            document.getElementById('numComponents').value = waveComponents.length;
            renderComponents();
        }
        
        // Función para eliminar un componente
        function removeComponent(index) {
            if (waveComponents.length > 1) {
                waveComponents.splice(index, 1);
                document.getElementById('numComponents').value = waveComponents.length;
                renderComponents();
            }
        }
        
        // Función para actualizar el tipo de componente
        function updateComponentType(index, type) {
            waveComponents[index].type = type;
            renderComponents();
        }
        
        // Función para actualizar valores de componente
        function updateComponentValue(index, property, value) {
            if (property === 'amplitude') {
                waveComponents[index].amplitude = parseFloat(value);
            } else if (property === 'frequency') {
                waveComponents[index].frequency = parseFloat(value);
            } else if (property === 'phase') {
                waveComponents[index].phase = parseFloat(value);
            } else if (property === 'enabled') {
                waveComponents[index].enabled = value;
            }
            
            // Actualizar el display del valor
            const component = document.getElementById(`component-${index}`);
            if (component) {
                const displays = component.querySelectorAll('.value-display');
                if (property === 'amplitude') displays[1].textContent = value;
                if (property === 'frequency') displays[2].textContent = parseFloat(value).toFixed(1) + ' Hz';
                if (property === 'phase') displays[3].textContent = value + '°';
                if (property === 'enabled') displays[4].textContent = value ? 'ON' : 'OFF';
            }
            
            updateFormula();
            updateInfo();
        }
        
        // Función para actualizar la fórmula mostrada
        function updateFormula() {
            const formula = waveComponents
                .filter(c => c.enabled)
                .map(c => {
                    const func = c.type === 'sin' ? 'sin' : 'cos';
                    return `${c.amplitude.toFixed(0)}·${func}(${c.frequency.toFixed(1)}·t + ${c.phase}°)`;
                })
                .join(' + ');
            
            document.getElementById('formulaDisplay').textContent = formula ? `y(t) = ${formula}` : 'y(t) = 0';
        }
        
        // Función para actualizar información
        function updateInfo() {
            const activeComps = waveComponents.filter(c => c.enabled);
            const maxAmp = activeComps.reduce((sum, c) => sum + c.amplitude, 0);
            
            document.getElementById('activeComponents').textContent = activeComps.length;
            document.getElementById('maxAmplitude').textContent = maxAmp.toFixed(0);
        }
        
        // Selectores de elementos de motor
        const motorSpeed = document.getElementById('motorSpeed');
        const motorDirection = document.getElementById('motorDirection');
        const linearRange = document.getElementById('linearRange');
        const linearSpeed = document.getElementById('linearSpeed');
        const linearPosition = document.getElementById('linearPosition');
        const linearMode = document.getElementById('linearMode');
        const rotatingMotor = document.getElementById('rotatingMotor');
        const linearSlider = document.getElementById('linearSlider');
        
        // Event listeners para motores
        motorSpeed.addEventListener('input', (e) => {
            document.getElementById('motorSpeedValue').textContent = e.target.value + ' RPM';
            updateMotorAnimation();
        });
        
        motorDirection.addEventListener('change', updateMotorAnimation);
        
        linearRange.addEventListener('input', (e) => {
            document.getElementById('linearRangeValue').textContent = e.target.value + ' mm';
            linearPosition.max = e.target.value;
        });
        
        linearSpeed.addEventListener('input', (e) => {
            document.getElementById('linearSpeedValue').textContent = e.target.value + ' mm/s';
        });
        
        linearPosition.addEventListener('input', (e) => {
            document.getElementById('linearPosValue').textContent = e.target.value + ' mm';
            if (linearMode.value === 'manual') {
                updateLinearPosition(e.target.value);
            }
        });
        
        linearMode.addEventListener('change', (e) => {
            linearPosition.disabled = e.target.value !== 'manual';
        });
        
        document.getElementById('globalSpeed').addEventListener('input', (e) => {
            document.getElementById('speedValue').textContent = e.target.value;
        });
        
        // Función para actualizar la animación del motor rotacional
        function updateMotorAnimation() {
            const rpm = parseInt(motorSpeed.value);
            const dir = parseInt(motorDirection.value);
            const duration = rpm > 0 ? (60 / rpm) : 999999;
            
            rotatingMotor.style.animationDuration = duration + 's';
            rotatingMotor.style.animationDirection = dir > 0 ? 'normal' : 'reverse';
            rotatingMotor.style.animationPlayState = rpm === 0 ? 'paused' : 'running';
        }
        
        // Función para actualizar la posición del motor lineal
        function updateLinearPosition(position) {
            const containerWidth = document.querySelector('.linear-motor').offsetWidth;
            const sliderWidth = 35;
            const maxPos = containerWidth - sliderWidth - 20;
            const range = parseInt(linearRange.value);
            const normalizedPos = (position / range) * maxPos;
            
            linearSlider.style.left = (10 + normalizedPos) + 'px';
            currentLinearPos = position;
            document.getElementById('currentPos').textContent = Math.round(position) + ' mm';
        }
        
        // Función principal de dibujo de ondas
        function drawWave(currentTime) {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            const speedFactor = parseInt(document.getElementById('globalSpeed').value) / 50;
            const timeIncrement = (currentTime - lastFrameTime) * 0.001 * speedFactor;
            animationTime += timeIncrement;
            
            // Actualizar tiempo
            document.getElementById('timeValue').textContent = animationTime.toFixed(2) + ' s';
            
            // Dibujar eje X
            ctx.strokeStyle = '#cbd5e0';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(0, canvas.height / 2);
            ctx.lineTo(canvas.width, canvas.height / 2);
            ctx.stroke();
            
            // Array para almacenar la suma de las ondas
            const summedWave = new Array(canvas.width).fill(0);
            
            // Calcular y dibujar cada componente
            waveComponents.forEach((component, compIndex) => {
                if (!component.enabled) return;
                
                ctx.strokeStyle = component.color + '40'; // Color con transparencia
                ctx.lineWidth = 1;
                ctx.beginPath();
                
                for (let x = 0; x < canvas.width; x++) {
                    const t = (x / canvas.width) * 4 * Math.PI;
                    const phaseRad = (component.phase * Math.PI) / 180;
                    
                    let y;
                    if (component.type === 'sin') {
                        y = component.amplitude * Math.sin(component.frequency * t + phaseRad - animationTime * component.frequency * 2 * Math.PI);
                    } else {
                        y = component.amplitude * Math.cos(component.frequency * t + phaseRad - animationTime * component.frequency * 2 * Math.PI);
                    }
                    
                    summedWave[x] += y;
                    const canvasY = canvas.height / 2 - y;
                    
                    if (x === 0) {
                        ctx.moveTo(x, canvasY);
                    } else {
                        ctx.lineTo(x, canvasY);
                    }
                }
                ctx.stroke();
            });
            
            // Dibujar la onda sumada
            ctx.strokeStyle = '#2d3748';
            ctx.lineWidth = 3;
            ctx.beginPath();
            
            let currentYValue = 0;
            for (let x = 0; x < canvas.width; x++) {
                const canvasY = canvas.height / 2 - summedWave[x];
                
                if (x === 0) {
                    ctx.moveTo(x, canvasY);
                } else {
                    ctx.lineTo(x, canvasY);
                }
                
                // Valor en el centro de la pantalla
                if (x === Math.floor(canvas.width / 2)) {
                    currentYValue = summedWave[x];
                    document.getElementById('currentY').textContent = currentYValue.toFixed(2);
                    
                    // Si el motor lineal está en modo "Seguir Onda"
                    if (linearMode.value === 'wave') {
                        const maxAmp = waveComponents
                            .filter(c => c.enabled)
                            .reduce((sum, c) => sum + c.amplitude, 0);
                        const range = parseInt(linearRange.value);
                        const normalizedY = ((currentYValue + maxAmp) / (2 * maxAmp)) * range;
                        updateLinearPosition(Math.max(0, Math.min(range, normalizedY)));
                    }
                }
            }
            ctx.stroke();
            
            // Dibujar indicador central
            ctx.strokeStyle = '#718096';
            ctx.setLineDash([5, 5]);
            ctx.lineWidth = 1;
            ctx.beginPath();
            ctx.moveTo(canvas.width / 2, 0);
            ctx.lineTo(canvas.width / 2, canvas.height);
            ctx.stroke();
            ctx.setLineDash([]);
            
            // Dibujar punto en el centro mostrando el valor actual
            ctx.fillStyle = '#e53e3e';
            ctx.beginPath();
            ctx.arc(canvas.width / 2, canvas.height / 2 - currentYValue, 5, 0, 2 * Math.PI);
            ctx.fill();
            
            // Animación del motor lineal automático
            if (linearMode.value === 'auto') {
                const lSpeed = parseInt(linearSpeed.value);
                const range = parseInt(linearRange.value);
                
                if (currentLinearPos >= range) {
                    linearDirection = -1;
                } else if (currentLinearPos <= 0) {
                    linearDirection = 1;
                }
                
                currentLinearPos += linearDirection * lSpeed * timeIncrement;
                currentLinearPos = Math.max(0, Math.min(range, currentLinearPos));
                
                updateLinearPosition(currentLinearPos);
                document.getElementById('currentVel').textContent = (lSpeed * linearDirection).toFixed(1) + ' mm/s';
                document.getElementById('motorStatus').textContent = 'En movimiento';
            } else if (linearMode.value === 'manual') {
                document.getElementById('currentVel').textContent = '0 mm/s';
                document.getElementById('motorStatus').textContent = 'Manual';
            } else if (linearMode.value === 'wave') {
                document.getElementById('motorStatus').textContent = 'Siguiendo onda';
                // Calcular velocidad aproximada basada en el cambio de posición
                const maxAmp = waveComponents
                    .filter(c => c.enabled)
                    .reduce((sum, c) => sum + c.amplitude, 0);
                if (maxAmp > 0) {
                    const avgFreq = waveComponents
                        .filter(c => c.enabled)
                        .reduce((sum, c, _, arr) => sum + c.frequency / arr.length, 0);
                    const approxVel = avgFreq * maxAmp * 2 * Math.PI * speedFactor;
                    document.getElementById('currentVel').textContent = Math.abs(approxVel).toFixed(1) + ' mm/s';
                }
            }
            
            lastFrameTime = currentTime;
            requestAnimationFrame(drawWave);
        }
        
        // Inicializar
        renderComponents();
        updateMotorAnimation();
        requestAnimationFrame((time) => {
            lastFrameTime = time;
            drawWave(time);
        });
    </script>
</body>
</html>